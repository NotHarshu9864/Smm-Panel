<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Batch | Nova PW</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        borderp:"#8b5cf6",
        textdim:"#9ca3af"
      }
    }
  }
}
</script>

<style>
body{background:#000;user-select:none}
.card{transition:.25s}
.card:hover{transform:translateY(-4px);box-shadow:0 0 12px rgba(139,92,246,.35)}
.tab{padding-bottom:.5rem}
.tab.active{border-bottom:2px solid #8b5cf6}
</style>
</head>

<body class="text-white">

<div class="max-w-6xl mx-auto px-5 py-6">

<!-- TITLE -->
<h1 id="batchName" class="text-3xl font-bold mb-4"></h1>

<!-- THUMB -->
<img id="batchThumb" class="rounded-xl mb-6 border border-borderp hidden">

<!-- TABS -->
<div class="flex gap-6 border-b border-borderp/40 mb-6">
  <button class="tab active" onclick="openTab('about',this)">About</button>
  <button class="tab" onclick="openTab('video',this)">Video</button>
  <button class="tab" onclick="openTab('notes',this)">Notes</button>
  <button class="tab" onclick="openTab('dpp',this)">DPP</button>
</div>

<!-- CONTENT -->
<div id="content"></div>

</div>

<script>
const batch = new URLSearchParams(location.search).get("id");
let batchData = {};
let subjects = [];
let currentType = "about";

/* LOAD ABOUT */
fetch(`/data/batches/${batch}/about.json`)
.then(r=>r.json())
.then(d=>{
  batchData = d;
  subjects = d.subjects;

  batchName.innerText = d.name;
  batchThumb.src = d.thumbnail;
  batchThumb.classList.remove("hidden");

  showAbout();
});

/* TAB HANDLER */
function openTab(type,btn){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  btn.classList.add("active");
  currentType = type;

  if(type==="about") showAbout();
  else showSubjects(type);
}

/* ABOUT */
function showAbout(){
  content.innerHTML = `
    <p class="text-textdim max-w-3xl leading-relaxed">
      ${batchData.description}
    </p>`;
}

/* SUBJECTS */
function showSubjects(type){
  content.innerHTML = `
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
      ${subjects.map(s=>`
        <div onclick="openSubject('${type}','${s}')"
             class="card border border-borderp rounded-xl p-4 cursor-pointer text-center">
          ${s.toUpperCase()}
        </div>`).join("")}
    </div>`;
}

/* SUBJECT → CHAPTER → ITEMS */
function openSubject(type,subject){
  fetch(`/data/batches/${batch}/${type}/${subject}.json`)
  .then(r=>r.json())
  .then(d=>{
    content.innerHTML = `<h2 class="text-xl font-semibold mb-4">${d.subject}</h2>`;

    d.chapters.forEach(ch=>{
      content.innerHTML += `
        <div class="border border-borderp/40 rounded-lg p-3 mb-3">
          <div class="font-medium cursor-pointer"
               onclick="this.nextElementSibling.classList.toggle('hidden')">
            ${ch.name}
          </div>

          <div class="hidden mt-3 space-y-2">
            ${ch.items.map(i=>`
              <div class="flex justify-between items-center text-sm text-textdim">
                <span>${i.title}</span>
                <a href="${i.link}"
                   class="border border-borderp px-3 py-0.5 rounded hover:bg-borderp hover:text-black transition">
                   Open
                </a>
              </div>`).join("")}
          </div>
        </div>`;
    });
  });
}
</script>

</body>
</html>